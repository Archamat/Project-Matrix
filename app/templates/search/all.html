{% extends "base.html" %}

{% block content %}
  {% if message %}
    <div class="search-placeholder">
      <p class="muted">{{ message }}</p>
    </div>
  {% else %}

<h2 class="mb-3 search-title">Search results for “{{ q }}”</h2>
  <!-- USERS -->
  <section class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="m-0">Users</h4>
      {% if counts.users > preview_limit %}
        <a href="{{ url_for('search.search_users', q=q) }}" class="small">See all {{ counts.users }} users →</a>
      {% endif %}
    </div>
    <ul class="list-unstyled">
      {% for u in users %}
        <li class="p-3 mb-2 border rounded d-flex justify-content-between align-items-center">
          <div>
            <a href="{{ url_for('profile.view_profile', username=u.username) }}" class="fw-bold">{{ u.username }}</a>
            {% if u.bio %}
              <div class="text-muted small">
                {{ u.bio[:140] }}{% if u.bio|length > 140 %}…{% endif %}
              </div>
            {% endif %}
          </div>
          <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('profile.view_profile', username=u.username) }}">View profile →</a>
        </li>
      {% else %}
        <p class="text-muted">No users found.</p>
      {% endfor %}
    </ul>
  </section>

  <!-- PROJECTS -->
  <section class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="m-0">Projects</h4>
      {% if counts.projects > preview_limit %}
        <a href="{{ url_for('search.search_projects', q=q) }}" class="small">See all {{ counts.projects }} projects →</a>
      {% endif %}
    </div>
    <div class="project-grid">
      {% for project in projects %}
        {% with is_creator=(current_user.is_authenticated and project.creator_id == current_user.id) %}
          {% include 'project_card.html' %}
        {% endwith %}
      {% else %}
        <p class="text-muted">No projects found.</p>
      {% endfor %}
    </div>
  </section>

  <!-- SKILLS -->
  <section class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="m-0">Skills</h4>
      {% if counts.skills > preview_limit %}
        <a href="{{ url_for('search.search_skills', q=q) }}" class="small">See all {{ counts.skills }} skills →</a>
      {% endif %}
    </div>
    <ul class="list-unstyled">
      {% for s in skills %}
        <li class="p-2 mb-1 border rounded d-flex justify-content-between">
          <span>{{ s.name }}</span>
          <a class="small" href="{{ url_for('search.search_users', skill=s.name) }}">See users →</a>
        </li>
      {% else %}
        <p class="text-muted">No skills found.</p>
      {% endfor %}
    </ul>
  </section>

  {% endif %}
{% endblock %}
