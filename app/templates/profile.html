{% extends 'base.html' %}

{% block content %}

<div class="profile-container">
    <!-- Left Sidebar -->
    <div class="sidebar">
        <ul class="sidebar-nav">
            <li><a href="#personal-info" class="sidebar-link active">Account Details</a></li>
            <li><a href="#skills" class="sidebar-link">Skills</a></li>
            <li class="has-submenu">
                <a href="#projects" class="sidebar-link">Projects</a>
                <ul class="submenu">
                    <li><a href="#created-projects" class="sidebar-link submenu-link">Created Projects</a></li>
                    <li><a href="#active-projects" class="sidebar-link submenu-link">Active Projects</a></li>
                    <li><a href="#favorite-projects" class="sidebar-link submenu-link">Favorite Projects</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <!-- Right Content Area -->
    <div class="content-area">
        <div id="personal-info" class="content-section active" >
            <h2 class=" fw-bold mb-4" style="font-size: 2rem; text-align: left;">
                Account Details: {{ user.username }}
            </h2>
            <!-- Account details content -->
            <div class="account-details" id="account-details">
                <div class="mb-3 text-center">
                    <img src="{{ user.avatar_presigned or url_for('static', filename='test_avatar.png') }}"
                        class="rounded-circle"
                         style="width:200px;height:200px;object-fit:cover;border:2px solid #eee;"
                        alt="Profile avatar">
                </div>
                <hr class="my-3">

                <h5 class="mb-2">Profile Description</h5>
                    <p class="text-muted" style="white-space: pre-line;">
                    {{ user.bio or 'No description yet.' }}
                </p>
                <p><strong>Username:</strong> {{ user.username }}</p>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Contact Info:</strong> {{ user.contact_info or 'Not provided' }}</p>
                <button type="button" class="btn btn-primary" onclick="toggleEditMode()">Edit Profile</button>
            </div>
        </div>      
        <div class="info-edit" id="info-edit" style="display: none;">
            
                <form method="POST"
                        action="{{ url_for('profile.upload_avatar') }}"
                        enctype="multipart/form-data"
                        class="mt-3">
                <div class="form-group">
                    <label for="avatar_file">Upload avatar image</label>
                    <input type="file" id="avatar_file" name="avatar_file" class="form-control" accept="image/*">
                </div>
                    <button type="submit" class="btn btn-primary mt-2">Upload to S3</button>
                </form>

                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}">
                </div>
                <div class="form-group">
                    <label for="contact_info">Contact Info</label>
                    <input type="text" class="form-control" id="contact_info" name="contact_info" value="{{ user.contact_info }}">
                </div>
                <div class="form-group">
                    <label for="bio">Profile Description</label>
                    <textarea class="form-control" id="bio" name="bio" rows="4"
                                placeholder="Tell others about yourself...">{{ user.bio or '' }}</textarea>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn btn-success">Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleEditMode()">Cancel</button>
                </div>
                
            </form>
        </div>

        <div id="skills" class="content-section">
            <h3>Skills</h3>
            <!-- Skills content -->
        </div>

        <div id="created-projects" class="content-section">
            <h3>Created Projects</h3>
            <div class="projects-grid">
                {% if user.projects %}
                    {% for project in user.projects %}
                        {% with is_creator=True %}
                            {% include 'project_card.html' %}
                        {% endwith %}
                    {% endfor %}
                {% else %}
                    <p>No projects created yet.</p>
                {% endif %}
            </div>
        </div>

        <div id="active-projects" class="content-section">
            <h3>Active Projects</h3>
            <p>Coming soon...</p>
        </div>

        <div id="favorite-projects" class="content-section">
            <h3>Favorite Projects</h3>
            <p>Coming soon...</p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sidebarLinks = document.querySelectorAll('.sidebar-link');
    const contentSections = document.querySelectorAll('.content-section');

    sidebarLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Remove active class from all links and sections
            sidebarLinks.forEach(l => l.classList.remove('active'));
            contentSections.forEach(s => s.classList.remove('active'));
            
            // Add active class to clicked link
            link.classList.add('active');
            
            // Show corresponding section
            const targetId = link.getAttribute('href').substring(1);
            document.getElementById(targetId).classList.add('active');
        });
    });
});

// Add this function to toggle between view and edit modes
function toggleEditMode() {
    const accountDetails = document.getElementById('account-details');
    const infoEdit = document.getElementById('info-edit');
    
    if (infoEdit.style.display === 'none') {
        accountDetails.style.display = 'none';
        infoEdit.style.display = 'block';
    } else {
        accountDetails.style.display = 'block';
        infoEdit.style.display = 'none';
    }
}

</script>
{% endblock %}