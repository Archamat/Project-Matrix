<!-- templates/login.html -->
{% extends 'base.html' %}
{% block title %}Log In - Project Matrix{% endblock %}
{% block flashes %}{% endblock %}
{% block content %}
<div class="auth-container">
  <div class="auth-card">
    <h2>Welcome back!</h2>
    <p class="subhead">Access your projects and move forward with confidence.</p>

    <form id="loginForm" action="{{ url_for('auth.login') }}" method="POST" novalidate>
      <!-- Username -->
      <div class="form-group">
        <label class="visually-hidden" for="username">Username</label>
        <input type="text" id="username" name="username"
               placeholder="Username" required autocomplete="username">
      </div>

      <!-- Password -->
      <div class="form-group" style="position:relative">
        <label class="visually-hidden" for="password">Password</label>
        <input type="password" id="password" name="password"
               placeholder="Password" required autocomplete="current-password">
        <button type="button" id="toggleLoginPass" class="password-toggle"
                aria-label="Show password">⊙</button>
      </div>

      <!-- Submit -->
      <button id="loginSubmit" type="submit" disabled>Log In</button>
    </form>
        {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="alert-custom {{ category }}">
          <span class="alert-text">{{ message }}</span>
          <button class="alert-close" onclick="this.parentElement.style.display='none';">&times;</button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

    <p><a href="{{ url_for('auth.register') }}">Don't have an account?</a></p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const u = document.getElementById('username');
  const p = document.getElementById('password');
  const b = document.getElementById('loginSubmit');

  function ok() { return u.value.trim().length > 0 && p.value.trim().length > 0; }
  function update() { b.disabled = !ok(); }
  u.addEventListener('input', update);
  p.addEventListener('input', update);
  update();

  const t = document.getElementById('toggleLoginPass');
  t.addEventListener('click', () => {
    const show = p.type === 'password';
    p.type = show ? 'text' : 'password';
    t.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
  });

  document.getElementById('loginForm').addEventListener('submit', () => {
    b.disabled = true;
    b.textContent = 'Logging in…';
  });
});
</script>
{% endblock %}
